name: Documentation Check for Magick++

on:
  push:
    branches:
      - main
  workflow_dispatch:
  schedule:
    - cron: 0 6 * * *

jobs:
  doxygen-check:
    name: 'Documentation Check'
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 2

    - name: Install Doxygen
      run: sudo apt-get install -y doxygen python3-pip && pip3 install pyarrow beautifulsoup4 pandas lxml

    - name: Compare documentation
      run: |
        cd ..
        cd config && doxygen Magick++.dox &> /dev/null
        DOC_HTML=("Blob.html" "CoderInfo.html" "Geometry.html" "Image++.html" "Montage.html" "Pixels.html")
        DOXY_HTML=("Blob.html" "CoderInfo.html" "Geometry.html" "Image.html" "Montage.html" "Pixels.html")  # Image.html is the only one that differs from the doxygen file
        for i in "${!DOC_HTML[@]}"; do
          python3 scripts/compare_signatures.py www/Magick++/"${DOC_HTML[$i]}" www/api/Magick++/classMagick_1_1"${DOXY_HTML[$i]}"
          echo ""
        done
